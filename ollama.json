{"status":{},"spec":{"name":"ollama","description":"","resources":{"service_definition_list":[{"name":"omaster","description":"","variable_list":[{"type":"LOCAL","name":"okp","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"value":""},{"type":"LOCAL","name":"test","description":"","regex":{"value":"^.*$","should_validate":false},"options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":true},"value":""}],"action_list":[{"type":"system","name":"action_create","description":"System action for creating an application","runbook":{"name":"243e19ce_runbook","description":"","task_definition_list":[{"type":"DAG","name":"954338fd_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"omaster","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"954338fd_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_delete","description":"System action for deleting an application. Deletes created VMs as well","runbook":{"name":"58a16141_runbook","description":"","task_definition_list":[{"type":"DAG","name":"221822dd_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"omaster","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"221822dd_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_start","description":"System action for starting an application","runbook":{"name":"9032e3fa_runbook","description":"","task_definition_list":[{"type":"DAG","name":"0f656280_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"omaster","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"0f656280_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_stop","description":"System action for stopping an application","runbook":{"name":"3ee932c4_runbook","description":"","task_definition_list":[{"type":"DAG","name":"3ef90683_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"omaster","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"3ef90683_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_restart","description":"System action for restarting an application","runbook":{"name":"08b35deb_runbook","description":"","task_definition_list":[{"type":"DAG","name":"bfe00476_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"omaster","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"bfe00476_dag","kind":"app_task"},"variable_list":[]},"critical":false}],"depends_on_list":[],"port_list":[],"singleton":false,"tier":""},{"name":"gui","description":"","variable_list":[],"action_list":[{"type":"system","name":"action_create","description":"System action for creating an application","runbook":{"name":"243e19ce_runbook_cloned_0","description":"","task_definition_list":[{"type":"DAG","name":"954338fd_dag_cloned_1","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"gui","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"954338fd_dag_cloned_1","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_delete","description":"System action for deleting an application. Deletes created VMs as well","runbook":{"name":"58a16141_runbook_cloned_0","description":"","task_definition_list":[{"type":"DAG","name":"221822dd_dag_cloned_1","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"gui","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"221822dd_dag_cloned_1","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_start","description":"System action for starting an application","runbook":{"name":"9032e3fa_runbook_cloned_0","description":"","task_definition_list":[{"type":"DAG","name":"0f656280_dag_cloned_1","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"gui","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"0f656280_dag_cloned_1","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_stop","description":"System action for stopping an application","runbook":{"name":"3ee932c4_runbook_cloned_0","description":"","task_definition_list":[{"type":"DAG","name":"3ef90683_dag_cloned_1","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"gui","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"3ef90683_dag_cloned_1","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"system","name":"action_restart","description":"System action for restarting an application","runbook":{"name":"08b35deb_runbook_cloned_0","description":"","task_definition_list":[{"type":"DAG","name":"bfe00476_dag_cloned_1","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"gui","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"bfe00476_dag_cloned_1","kind":"app_task"},"variable_list":[]},"critical":false}],"depends_on_list":[{"kind":"app_service","name":"omaster"}],"port_list":[],"singleton":false,"tier":""}],"published_service_definition_list":[],"substrate_definition_list":[{"type":"AHV_VM","name":"Ollama_Server_VM","description":"","variable_list":[],"action_list":[],"editables":{"create_spec":{"resources":{"memory_size_mib":true}}},"create_spec":{"type":"","name":"PP_vm-@@{calm_array_index}@@-@@{calm_time}@@","availability_zone_reference":null,"backup_policy":null,"cluster_reference":{"type":"","kind":"cluster","name":"PHX-POC264","uuid":"000624fd-7ee6-6599-708c-ac1f6b3de868"},"resources":{"type":"","nic_list":[{"type":"","nic_type":"NORMAL_NIC","subnet_reference":{"type":"","kind":"subnet","name":"","uuid":"1363c2da-dcfb-40f1-8e11-3863b35ea58e"},"network_function_nic_type":"INGRESS","mac_address":"","ip_endpoint_list":[],"network_function_chain_reference":null,"vpc_reference":null}],"power_state":"ON","guest_tools":null,"num_vcpus_per_socket":2,"num_sockets":8,"memory_size_mib":32768,"gpu_list":[],"parent_reference":null,"hardware_clock_timezone":"","account_uuid":"14005948-ef79-4725-a010-71b05aad0f90","guest_customization":{"type":"","cloud_init":{"type":"","meta_data":"","user_data":"#cloud-config\nssh_pwauth: true\nchpasswd:\n  expire: false\n  users:\n  - name: nutanix\n    password: nutanix\/4u # Recommended to change the password or update the script to use SSH keys\n    type: text\nbootcmd:\n- mkdir -p \/etc\/docker\nwrite_files:\n- content: |\n    {\n        \"insecure-registries\": [\"registry.nutanixdemo.com\"]\n    }\n  path: \/etc\/docker\/daemon.json\nruncmd:\n- mv \/etc\/yum.repos.d\/nutanix_rocky9.repo \/etc\/yum.repos.d\/nutanix_rocky9.repo.disabled\n- dnf config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\n- dnf -y install docker-ce docker-ce-cli containerd.io docker-compose-plugin git tmux\n- systemctl --now enable docker\n- usermod -aG docker nutanix\n- 'curl -LO https:\/\/storage.googleapis.com\/kubernetes-release\/release\/$(curl -s https:\/\/storage.googleapis.com\/kubernetes-release\/release\/stable.txt)\/bin\/linux\/amd64\/kubectl'\n- chmod +x .\/kubectl\n- mv .\/kubectl \/usr\/local\/bin\/kubectl\n- '\\curl https:\/\/raw.githubusercontent.com\/helm\/helm\/main\/scripts\/get-helm-3 | bash'\n- git clone https:\/\/github.com\/vEDW\/nkp-quickstart.git \/home\/nutanix\n- eject"},"sysprep":null},"boot_config":{"type":"","boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"mac_address":"","boot_type":"LEGACY"},"disk_list":[{"type":"","data_source_reference":{"type":"","kind":"image","name":"nkp-rocky-9.4-release-1.29.9-20241008013213.qcow2","uuid":"9b946b24-4f49-4c4d-b239-1056bcb7d0ef"},"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"},"disk_size_mib":102400}],"serial_port_list":[]},"categories":{}},"os_type":"Linux","readiness_probe":{"login_credential_local_reference":{"name":"standardNX","kind":"app_credential"},"connection_type":"SSH","connection_port":22,"delay_secs":"0","retries":"5","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","disable_readiness_probe":true,"connection_protocol":""}},{"type":"AHV_VM","name":"OpenWebGUI_VM","description":"","variable_list":[],"action_list":[],"editables":{"create_spec":{"resources":{"memory_size_mib":true}}},"create_spec":{"type":"","name":"PP_vm-@@{calm_array_index}@@-@@{calm_time}@@","availability_zone_reference":null,"backup_policy":null,"cluster_reference":{"type":"","kind":"cluster","name":"PHX-POC264","uuid":"000624fd-7ee6-6599-708c-ac1f6b3de868"},"resources":{"type":"","nic_list":[{"type":"","nic_type":"NORMAL_NIC","subnet_reference":{"type":"","kind":"subnet","name":"","uuid":"1363c2da-dcfb-40f1-8e11-3863b35ea58e"},"network_function_nic_type":"INGRESS","mac_address":"","ip_endpoint_list":[],"network_function_chain_reference":null,"vpc_reference":null}],"power_state":"ON","guest_tools":null,"num_vcpus_per_socket":2,"num_sockets":4,"memory_size_mib":65536,"gpu_list":[],"parent_reference":null,"hardware_clock_timezone":"","account_uuid":"14005948-ef79-4725-a010-71b05aad0f90","guest_customization":{"type":"","cloud_init":{"type":"","meta_data":"","user_data":"#cloud-config\nssh_pwauth: true\nchpasswd:\n  expire: false\n  users:\n  - name: nutanix\n    password: nutanix\/4u # Recommended to change the password or update the script to use SSH keys\n    type: text\nbootcmd:\n- mkdir -p \/etc\/docker\nwrite_files:\n- content: |\n    {\n        \"insecure-registries\": [\"registry.nutanixdemo.com\"]\n    }\n  path: \/etc\/docker\/daemon.json\nruncmd:\n- mv \/etc\/yum.repos.d\/nutanix_rocky9.repo \/etc\/yum.repos.d\/nutanix_rocky9.repo.disabled\n- dnf config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\n- dnf -y install docker-ce docker-ce-cli containerd.io docker-compose-plugin git tmux\n- systemctl --now enable docker\n- usermod -aG docker nutanix\n- 'curl -LO https:\/\/storage.googleapis.com\/kubernetes-release\/release\/$(curl -s https:\/\/storage.googleapis.com\/kubernetes-release\/release\/stable.txt)\/bin\/linux\/amd64\/kubectl'\n- chmod +x .\/kubectl\n- mv .\/kubectl \/usr\/local\/bin\/kubectl\n- '\\curl https:\/\/raw.githubusercontent.com\/helm\/helm\/main\/scripts\/get-helm-3 | bash'\n- git clone https:\/\/github.com\/vEDW\/nkp-quickstart.git \/home\/nutanix\n- eject"},"sysprep":null},"boot_config":{"type":"","boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"mac_address":"","boot_type":"LEGACY"},"disk_list":[{"type":"","data_source_reference":{"type":"","kind":"image","name":"nkp-rocky-9.4-release-1.29.9-20241008013213.qcow2","uuid":"9b946b24-4f49-4c4d-b239-1056bcb7d0ef"},"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"},"disk_size_mib":102400}],"serial_port_list":[]},"categories":{}},"os_type":"Linux","readiness_probe":{"login_credential_local_reference":{"name":"standardNX","kind":"app_credential"},"connection_type":"SSH","connection_port":22,"delay_secs":"0","retries":"5","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","disable_readiness_probe":true,"connection_protocol":""}}],"package_definition_list":[{"type":"DEB","name":"Package1","description":"","variable_list":[],"action_list":[],"service_local_reference_list":[{"name":"omaster","kind":"app_service"}],"version":"","options":{"type":"","install_runbook":{"name":"c3e257d0_runbook","description":"","task_definition_list":[{"type":"DAG","name":"7f46a9bc_dag","description":"","attrs":{"type":"","edges":[{"type":"","from_task_reference":{"name":"Installa_ollama","kind":"app_task"},"to_task_reference":{"name":"aggiungi_llam3_2_model","kind":"app_task"},"edge_type":"user_defined"}]},"child_tasks_local_reference_list":[{"name":"Installa_ollama","kind":"app_task"},{"name":"aggiungi_llam3_2_model","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"Package1","kind":"app_package"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"EXEC","name":"Installa_ollama","description":"","attrs":{"type":"","script":"#!\/bin\/bash\nset -ex\n\ncurl -fsSL https:\/\/ollama.com\/install.sh | sh\n\necho \"bah\"","script_type":"sh","command_line_args":"","exit_status":[],"login_credential_local_reference":{"name":"standardNX","kind":"app_credential"}},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"omaster","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"EXEC","name":"aggiungi_llam3_2_model","description":"","attrs":{"type":"","script":"ollama pull llama3.2\n\n#ollama serve\nsudo sed -i '8a Environment=\"OLLAMA_HOST=0.0.0.0\"' \/etc\/systemd\/system\/ollama.service\n\nsudo systemctl daemon-reload\nsudo systemctl restart ollama\n\necho \"fatto\"","script_type":"sh","command_line_args":"","exit_status":[],"login_credential_local_reference":{"name":"standardNX","kind":"app_credential"}},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"omaster","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"7f46a9bc_dag","kind":"app_task"},"variable_list":[]},"uninstall_runbook":{"name":"2bbe2c0b_runbook","description":"","task_definition_list":[{"type":"DAG","name":"2766ac8b_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Package1","kind":"app_package"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"2766ac8b_dag","kind":"app_task"},"variable_list":[]},"upgrade_runbook":{}}},{"type":"DEB","name":"Package1_cloned_0","description":"","variable_list":[],"action_list":[],"service_local_reference_list":[{"name":"gui","kind":"app_service"}],"version":"","options":{"type":"","install_runbook":{"name":"c3e257d0_runbook_cloned_0","description":"","task_definition_list":[{"type":"DAG","name":"7f46a9bc_dag_cloned_1","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[{"name":"installa_OpenWebGUI_app","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"Package1_cloned_0","kind":"app_package"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"EXEC","name":"installa_OpenWebGUI_app","description":"","attrs":{"type":"","script":"#!\/bin\/bash\nset -ex\n\n\nsudo systemctl stop firewalld\n\n\n\nsleep 160\n\n\n\nsudo docker run -d --network=host  -e OLLAMA_BASE_URL=http:\/\/@@{omaster.address}@@:11434 -v open-webui:\/app\/backend\/data --name open-webui --restart always ghcr.io\/open-webui\/open-webui:main","script_type":"sh","command_line_args":"","exit_status":[],"login_credential_local_reference":{"name":"standardNX","kind":"app_credential"}},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"gui","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"7f46a9bc_dag_cloned_1","kind":"app_task"},"variable_list":[]},"uninstall_runbook":{"name":"2bbe2c0b_runbook_cloned_0","description":"","task_definition_list":[{"type":"DAG","name":"2766ac8b_dag_cloned_1","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"Package1_cloned_0","kind":"app_package"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"2766ac8b_dag_cloned_1","kind":"app_task"},"variable_list":[]},"upgrade_runbook":{}}}],"app_profile_list":[{"name":"Default","description":"","variable_list":[],"action_list":[],"deployment_create_list":[{"type":"GREENFIELD","name":"deployment_5396818b","description":"","variable_list":[],"action_list":[],"depends_on_list":[],"min_replicas":"1","max_replicas":"1","default_replicas":"1","package_local_reference_list":[{"name":"Package1","kind":"app_package"}],"substrate_local_reference":{"name":"Ollama_Server_VM","kind":"app_substrate"},"published_service_local_reference_list":[]},{"type":"GREENFIELD","name":"deployment_ba57402e","description":"","variable_list":[],"action_list":[],"depends_on_list":[],"min_replicas":"1","max_replicas":"1","default_replicas":"1","package_local_reference_list":[{"name":"Package1_cloned_0","kind":"app_package"}],"substrate_local_reference":{"name":"OpenWebGUI_VM","kind":"app_substrate"},"published_service_local_reference_list":[]}],"snapshot_config_list":[],"restore_config_list":[],"environment_reference_list":[],"application_url":"","patch_list":[]}],"credential_definition_list":[{"type":"PASSWORD","name":"standardNX","description":"","username":"nutanix","secret":{"attrs":{"secret_reference":{},"is_secret_modified":true},"value":"Urr\/BX1W22T8fdYeHhWxsMCU\/BH8a\/chn4liQZpQ23KNq3hDtNb7MlzV:utf-8"},"cred_class":"static"}],"default_credential_local_reference":{"name":"standardNX","kind":"app_credential"},"type":"USER","client_attrs":{"deployment_5396818b":{"x":247,"y":300},"deployment_ba57402e":{"x":473,"y":298}}}},"api_version":"3.0","product_version":"3.8.1","metadata":{"last_update_time":"1734807141356102","creation_time":"1734723309295147","spec_version":24,"name":"ollama","kind":"blueprint"},"contains_secrets":true}